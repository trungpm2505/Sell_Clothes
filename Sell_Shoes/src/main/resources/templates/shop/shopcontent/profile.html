<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{shop/fragments/index.html}">
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
	<div layout:fragment="content">
		<style>
.error {
	color: red;
	font-size: 14px;
	font-style: italic;
	margin-top: 5px;
	display: block;
}
</style>
		<!-- Start Maincontent  -->
		<section>

			<div class="container">
				<div class="row">
					<div class="col-2">
						<div class="row">
							<div class="col-md-4" style="margin-top: 10px">
								<img src="https://img.freepik.com/premium-vector/account-icon-user-icon-vector-graphics_292645-552.jpg" alt=""
									class="shopee-avatar__img">
							</div>
							<div class="col-md-8">
								<div class="mC1Llc" th:text="${fullName}"></div>
							</div>
						</div>
						<div
							th:replace="shop/shopcontent/navbar_account :: navbar_account"></div>

					</div>
					<div class="col-md-10">
						<div class="tab-pane fade show active" id="account-details">
							<div>
								<div class="card">
									<div class="card-header">
										<center>
											<h3>Account Details</h3>
										</center>
									</div>
									<div class="card-body" style="font-size: 17px">
										<div class="row">
											<div class="col">
												<input type="hidden" class="form-control" id="id"
													aria-describedby="" th:field="${user.id}">

												<div class="form-group">
													<label for="fullname" style="font-size: 16px;">FullName</label>
													<input type="text" class="form-control" name="fullname"
														id="fullname" aria-describedby="" placeholder="Fullname"
														th:field="${user.fullName}"> <span
														id="fullname-error" class="text-danger error"></span>
												</div>
												<div class="form-group">
													<label for="email" style="font-size: 16px;">Email</label> <input
														type="email" class="form-control" name="email" id="email"
														aria-describedby="" placeholder="Email"
														th:field="${user.email}" readonly> <span
														id="email-error" class="text-danger error"></span>
												</div>
											</div>
											<div class="col">
												<div class="form-group">
													<label for="fullname" style="font-size: 16px;">Address</label>
													<input type="text" class="form-control" name="address"
														id="address" aria-describedby="" placeholder="Address"
														th:field="${user.address}"> <span
														id="address-error" class="text-danger error"></span>
												</div>
												<div class="form-group">
													<label for="number" style="font-size: 16px;">Phone</label>
													<input type="tel" class="form-control" name="phone"
														id="phone" placeholder="Phone" th:field="${user.phone}">
													<span id="phone-error" class="text-danger error"></span>
												</div>
											</div>
										</div>
									</div>
									<div class="card-footer text-muted">
										<button type="submit" class="btn btn-success"
											style="font-size: 16px" onclick="editProfile()">SAVE</button>
									</div>
								</div>
							</div>
						</div>





					</div>
				</div>
			</div>



		</section>
		<!-- Modal refuse-->
		<div class="modal" id="refuseOrder">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title" id="exampleModalLabel">Cancel order</h5>
						<button type="button" class="close" data-bs-dismiss="modal">&times;</button>
					</div>
					<div class="modal-body">
						<p>Are you sure you want to cancel this order??</p>
						<input type="hidden" th:id="orderIdRefuseModal" name="orderId">
						<input type="hidden" th:id="statusRefuseModal" name="status">

					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary"
							data-ba-dismiss="modal">Cancel</button>
						<button type="button" data-id="" data-update-status="2"
							class="btn btn-danger" th:id="refuse-order-modal"
							onclick='updateStatus(event)'>Confirm</button>
					</div>
				</div>
			</div>
		</div>
		<!-- End Maincontent  -->
		<!-- Thêm Bootstrap JS -->

		<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
		<script
			src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
		<script
			src="https://cdnjs.cloudflare.com/ajax/libs/js-cookie/2.2.1/js.cookie.min.js"></script>

		<script>
			function editProfile() {
				var id = $("#id").val();
				var fullname = $("#fullname").val();
				var address = $("#address").val();
				var phone = $("#phone").val();

				csrfToken = Cookies.get('XSRF-TOKEN');

				$.ajax({
					type : 'put',
					url : '/account/editAccount',
					data : {
						id : id,
						fullname : fullname,
						address : address,
						phone : phone
					},
					headers : {
						'X-XSRF-TOKEN' : csrfToken
					},
					success : function(data) {
						$(".error").text("");
						toastr.success(data);
					},
					error : function(jqXHR, textStatus, errorMessage) {
						if (jqXHR.status === 400) {
							var errors = jqXHR.responseJSON;

							// Xử lý lỗi từ phản hồi JSON
							if (errors.hasOwnProperty("bindingErrors")) {
								var bindingErrors = errors["bindingErrors"];
								for (var i = 0; i < bindingErrors.length; i++) {
									var error = bindingErrors[i];
									$("#" + error.field + "-error").text(
											error.defaultMessage);
								}
							}
							if (errors.hasOwnProperty("phone")) {
								var phoneError = errors["phone"];
								$("#phone-error").text(phoneError);
							}
						} else {
							alert("Sorry! The system has errors!");
						}
					}
				});
			}

			var inputList = [ 'fullname', 'email', 'address', 'phone' ];

			inputList.forEach(function(inputName) {
				var input = document.getElementById(inputName);
				var error = document.getElementById(inputName + '-error');

				if (input) {
					input.addEventListener("focus", function() {
						error.textContent = '';
					});
				} else {
					console.error("Không tìm thấy phần tử với ID '" + inputName
							+ "' trong trang.");
				}
			});
			
			var csrfToken = null;
			document.getElementById("logout-form").addEventListener("submit", function(event) {
			    // Gửi yêu cầu AJAX
			    var xhr = new XMLHttpRequest();
			    xhr.open("POST", "/logout", true);
			    xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
			    
			    if (Cookies.get('XSRF-TOKEN')) {
			        csrfToken = Cookies.get('XSRF-TOKEN');
			        xhr.setRequestHeader("X-XSRF-TOKEN", csrfToken);
			    }
			    
			    xhr.onload = function() {
			        if (xhr.status === 200) {
			            // Chuyển hướng người dùng về trang chủ sau khi đăng xuất thành công
			            window.location.href = "/product/index";
			        } 
			    };
			    
			    xhr.send(new FormData(event.target));
			    event.preventDefault(); // Ngăn chặn sự kiện mặc định của form
			});
		</script>
	</div>
</body>
</html>