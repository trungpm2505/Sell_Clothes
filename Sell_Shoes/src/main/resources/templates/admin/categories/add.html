<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"  
  layout:decorate="~{admin/fragments/home.html}">
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
  <link href="/adminview/admincategories/css/admincategories.css" rel="stylesheet">
  <!--  <script src="/adminview/admincategories/js/crudcategory.js"></script> -->
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.3/dist/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script>
/**
 * 
 */
 document.addEventListener("DOMContentLoaded", function() {
	 var keyword = document.getElementById('searchcategoryName').value;
	    getlistCategories(0, keyword);
	});
 function searchCategories() {
	    var keyword = document.getElementById('searchcategoryName').value;
	    getlistCategories(0, keyword);
	}
 function getAllCategories() {
	    getlistCategories(0, ''); // Truyền từ khóa trống để lấy tất cả danh mục
	}

	function getlistCategories(page, keyword) {
	    // Sử dụng Ajax để lấy danh sách categories
	    $.ajax({
	        type: "GET",
	        url: "/category/getCategories", 
	        data: {
	            page: page,
	            keyword: keyword
	        },
	        success: function(response) {
	            console.log(response);
	            // Xóa dữ liệu cũ trong tbody
	            $("#categoryTable tbody").empty();
	            
	            var categories = response.content;
	            
	            // Duyệt qua danh sách categories và thêm chúng vào tbody
	            for (var i = 0; i < categories.length; i++) {
	                var category = categories[i];
	                
	                var row = '<tr>' +
	                    '<td>' + category.id + '</td>' +
	                    '<td>' + category.categoryName + '</td>' +
	                    '<td>' + category.createAt + '</td>' +
	                    '<td>' + (category.updateAt ? category.updateAt : '') + '</td>' +
	                    '<td>' +
	                        '<i class="fa fa-trash-o" style="color: red;"></i><span onclick="deleteCategory(' + category.id + ', \'' + category.categoryName + '\')"  style="color: red;">Delete</span>' +
	                    '</td>' +  
	                    '<td>' +
	                        '<i class="fa fa-pencil"></i><span onclick="editCategory(' + category.id + ', \'' + category.categoryName + '\')" >Edit</span>' +
	                    '</td>' +
	                    '</tr>';
	                $("#categoryTable tbody").append(row);
	            }
	            
	        },
	        error: function(error) {
	            console.error(error);
	        }
	    });
	}

	

	

 

function ss() {
  
			var categoryName = document.getElementById("categoryName").value;
		
			$.ajax({
				type : 'POST',
				url : '/category/saveCategory',
				data : {
					
					categoryName : categoryName
				},
				success : function(response) {
					console.log("thanh cong")
					  getlistCategories();
					  $('#exampleModalCenter').modal('hide');
				},
				error : function(xhr, status, error) {
					console.log(error);
					console.log(status);
				}
			});
}



function deleteCategory(id,categoryName) {
    // Hiển thị modal xác nhận xóa
    $("#confirmDeleteModal").modal("show");
$("#categoryIdToDelete").text(categoryName);
    // Thiết lập sự kiện cho nút "Xóa" trong modal xác nhận
    $("#confirmDeleteButton").off("click").on("click", function () {
        $.ajax({
            type: 'get',
            url: 'category/deleteCategory',
            data: {
                idCategory: id,
            },
            success: function (response) {
                console.log("Xóa thành công");
                getlistCategories();
                // Đóng modal sau khi xóa thành công
                $("#confirmDeleteModal").modal("hide");
            },
            error: function (xhr, status, error) {
                console.log("Lỗi khi xóa bình luận");
                console.log(error);
                console.log(status);
                // Đóng modal nếu xóa thất bại
                $("#confirmDeleteModal").modal("hide");
            }
        });
    });
}

function editCategory(id, categoryName) {
    // Điền giá trị của id và categoryName vào các trường input
    $("#editCategoryId").val(id);
    $("#editCategoryName").val(categoryName);

    // Hiển thị modal chỉnh sửa danh mục
    $("#editCategoryModal").modal("show");

    // Thiết lập sự kiện cho nút "Lưu thay đổi"
    $("#saveCategoryChanges").off("click").on("click", function () {
        // Lấy giá trị mới từ các trường input (nếu bạn muốn cập nhật)
        var newCategoryName = $("#editCategoryName").val();
        var newIdCategory = $("#editCategoryId").val();
        // Gửi AJAX request để cập nhật danh mục (sử dụng newCategoryId và newCategoryName)
        $.ajax({
            type: 'post',
            url: 'category/editCategory',
            data: {
            	idCategory:newIdCategory,
                categoryName: newCategoryName
            },
            success: function (response) {
                console.log("Chỉnh sửa thành công");
                getlistCategories();
                // Đóng modal sau khi chỉnh sửa thành công
                $("#editCategoryModal").modal("hide");
            },
            error: function (xhr, status, error) {
                console.log("Lỗi khi chỉnh sửa danh mục");
                console.log(error);
                console.log(status);
                // Đóng modal nếu chỉnh sửa thất bại
                $("#editCategoryModal").modal("hide");
            }
        });
    });
}



</script>
</head>

<body>
    
     <div   layout:fragment="content">
    <section class="row mt-4">
    <div class="col mt-4">
      
        <div class="card">
            <div class="card-header">
                <h2>LIST OF CATEGORY</h2>
              </div>
    
              <div class="card-body">
        <div class="row mt-2 mb-2">
            <div class="col">
<form action="" id="searchForm">
    <div class="form-inline float-right">
        <label for="searchCategoryName">Tìm theo tên danh mục:</label>
        <input type="text" class="form-control ml-2" name="categoryName" id="searchcategoryName" placeholder="Tên danh mục">
        <button class="btn btn-outline-info ml-2" type="button" onclick="searchCategories()"><i class="fa fa-search"></i> Tìm kiếm</button>
        <button class="btn btn-outline-secondary ml-2" type="button" onclick="getAllCategories()"><i class="fa fa-list"></i> Tất cả</button>
    </div>
</form>


          

<button type="button" class="btn btn-outline-info float-left" data-toggle="modal" data-target="#exampleModalCenter">
       <i class="fa fa-plus-square-o"></i> Add new categories
</button>


<!-- Modal -->
   <div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true" data-backdrop="false">
   
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLongTitle">Modal title</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
        <form  >
    <div class="form-group" >
        <label for="inputId">ID:</label>
        <input  type="text" class="form-control" id="id" name="id" placeholder="Enter ID">
    </div>
    <div class="form-group">
        <label for="inputName">Name:</label>
        <input type="text" class="form-control" id="categoryName" name="categoryName" placeholder="Enter Name">
    </div>
     <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" onclick="ss()">Save changes</button>
            </div>
</form>

            </div>
           
        </div>
    </div>
</div>
            </div>
        </div>
	<table id="categoryTable">
    <thead>
        <tr>
            <th>Category ID</th>
            <th>Name</th>
            <th>Create Date</th>
            <th>Edit Date</th>
           <th colspan="2">Action</th>
        </tr>
    </thead>
    <tbody>
        <!-- Dữ liệu categories sẽ được thêm vào đây bằng Ajax -->
    </tbody>
</table>

<!-- Modal xác nhận xóa -->
<div class="modal fade" id="confirmDeleteModal" tabindex="-1" role="dialog" aria-labelledby="confirmDeleteModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="confirmDeleteModalLabel">Xác nhận xóa</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                 Bạn có chắc chắn muốn xóa category có tên là <span id="categoryIdToDelete"></span>?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Hủy</button>
                <button type="button" class="btn btn-danger" id="confirmDeleteButton">Xóa</button>
            </div>
        </div>
    </div>
</div>

<!-- modal edit category -->
<div class="modal fade" id="editCategoryModal" tabindex="-1" role="dialog" aria-labelledby="editCategoryModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editCategoryModalLabel">Chỉnh sửa danh mục</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <!-- Form chỉnh sửa danh mục sẽ được thêm vào đây -->
                    <form id="editCategoryForm">
        <div class="form-group">
            <label for="editCategoryId">ID:</label>
            <input type="text" class="form-control" id="editCategoryId" name="idCategory" readonly>
        </div>
        <div class="form-group">
            <label for="editCategoryName">Tên danh mục:</label>
            <input type="text" class="form-control" id="editCategoryName" name="categoryName">
        </div>
    </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Đóng</button>
                <button type="button" class="btn btn-primary" id="saveCategoryChanges">Lưu thay đổi</button>
            </div>
        </div>
    </div>
</div>

    </div>  
   
     
     <div class="card-footer text-muted">
        <nav aria-label="Page navigation">
          <ul class="pagination justify-content-center">
            <li class="page-item disabled">
              <a class="page-link" href="#" aria-label="Previous">
                <span aria-hidden="true">&laquo;</span>
                <span class="sr-only">Previous</span>
              </a>
            </li>
            <li class="page-item active"><a class="page-link" href="#">1</a></li>
            <li class="page-item"><a class="page-link" href="#">2</a></li>
            <li class="page-item">
              <a class="page-link" href="#" aria-label="Next">
                <span aria-hidden="true">&raquo;</span>
                <span class="sr-only">Next</span>
              </a>
            </li>
          </ul>
        </nav>
      </div>   
    </div>
      </div>
  </section>
        </div>
</body>

</html>